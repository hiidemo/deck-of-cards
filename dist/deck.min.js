var Deck=function(){"use strict";function q(n){return document.createElement(n)}var r,i=[];function C(n,t){var n=Date.now()+n,e={start:n,end:n+t},o=(i.push(e),r||(r=!0,requestAnimationFrame(u)),{start:function(n){return e.startcb=n,o},progress:function(n){return e.progresscb=n,o},end:function(n){return e.endcb=n,o}});return o}function u(){var n=Date.now();if(i.length){for(var t,e,o=0;o<i.length;o++)n<(e=i[o]).start||(e.started||(e.started=!0,e.startcb&&e.startcb()),t=(n-e.start)/(e.end-e.start),e.progresscb&&e.progresscb(t<1?t:1),n>e.end&&(e.endcb&&e.endcb(),i.splice(o--,1)));requestAnimationFrame(u)}else r=!1}"undefined"==typeof window||window.requestAnimationFrame||(window.requestAnimationFrame=function(n){setTimeout(n,0)});var a,I={linear:function(n){return n},quadIn:function(n){return n*n},quadOut:function(n){return n*(2-n)},quadInOut:function(n){return n<.5?2*n*n:(4-2*n)*n-1},cubicIn:function(n){return n*n*n},cubicOut:function(n){return--n*n*n+1},cubicInOut:function(n){return n<.5?4*n*n*n:(n-1)*(2*n-2)*(2*n-2)+1},quartIn:function(n){return n*n*n*n},quartOut:function(n){return 1- --n*n*n*n},quartInOut:function(n){return n<.5?8*n*n*n*n:1-8*--n*n*n*n},quintIn:function(n){return n*n*n*n*n},quintOut:function(n){return 1+--n*n*n*n*n},quintInOut:function(n){return n<.5?16*n*n*n*n*n:1+16*--n*n*n*n*n}};function c(){return window.getComputedStyle(document.body).getPropertyValue("font-size").slice(0,-2)}var d,n={deck:function(n){n.bysuit=n.queued(function(t){var e=n.cards;a=c(),e.forEach(function(n){n.bysuit(function(n){n===e.length-1&&t()})})})},card:function(e){var o=e.rank,r=e.suit;e.bysuit=function(n){var t=e.i;e.animateTo({delay:10*t,duration:400,x:-Math.round(8*(6.75-o)*a/16),y:-Math.round(92*(1.5-r)*a/16),rot:0,onComplete:function(){n(t)}})}}},t={deck:function(n){n.fan=n.queued(function(e){var o=n.cards,r=o.length;d=c(),o.forEach(function(n,t){n.fan(t,r,function(n){n===o.length-1&&e()})})})},card:function(i){var u=i.$el;i.fan=function(n,t,e){var o=n/4,r=10*n,t=n/(t-1)*260-130;i.animateTo({delay:r,duration:300,x:-o,y:-o,rot:0}),i.animateTo({delay:300+r,duration:300,x:55*Math.cos(s(t-90))*d/16,y:55*Math.sin(s(t-90))*d/16,rot:t,onStart:function(){u.style.zIndex=n},onComplete:function(){e(n)}})}}};function s(n){return n*Math.PI/180}var f,l=document.createElement("p").style,y={};function S(n){if(void 0!==y[n])return y[n];if(void 0!==l[n])return y[n]=n;for(var t,e=n[0].toUpperCase()+n.slice(1),o=["webkit","moz","Moz","ms","o"],r=0,i=o.length;r<i;r++)if(void 0!==l[t=o[r]+e])return y[n]=t}function M(n,t,e){var o,r;return e=e||0,(f=void 0===f?!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(o=S("transform"),r=document.createElement("p"),document.body.appendChild(r),r.style[o]="translate3d(1px,1px,1px)",f=null!=(f=r.style[o])&&f.length&&"none"!==f,document.body.removeChild(r),f):f)?"translate3d("+n+", "+t+", "+e+")":"translate("+n+", "+t+")"}var p,m,e={deck:function(n){n.intro=n.queued(function(e){var o=n.cards;o.forEach(function(t,n){t.setSide("front"),t.intro(n,function(n){C(250,0).start(function(){t.setSide("back")}),n===o.length-1&&e()})})})},card:function(r){var i=S("transform"),u=r.$el;r.intro=function(n,t){var e=500+10*n,o=n/4;u.style[i]=M(-o+"px","-250px"),u.style.opacity=0,r.x=-o,r.y=-250-o,r.rot=0,r.animateTo({delay:e,duration:1e3,x:-o,y:-o,onStart:function(){u.style.zIndex=n},onProgress:function(n){u.style.opacity=n},onComplete:function(){u.style.opacity="",t&&t(n)}})}}},o={deck:function(t){t.poker=t.queued(function(e){var n=t.cards,o=n.length;p=c(),n.slice(-5).reverse().forEach(function(t,n){t.poker(n,o,function(n){t.setSide("front"),4===n&&e()})})})},card:function(o){var r=o.$el;o.poker=function(n,t,e){o.animateTo({delay:250*n,duration:250,x:Math.round(70*(n-2.05)*p/16),y:Math.round(-110*p/16),rot:0,onStart:function(){r.style.zIndex=t-1+n},onComplete:function(){e(n)}})}}};var v={deck:function(n){n.shuffle=n.queued(function(e){var o=n.cards;m=c(),function(n){for(var t,e,o=n.length-1;o;o--)t=Math.floor(Math.random()*(o+1)),e=n[o],n[o]=n[t],n[t]=e}(o),o.forEach(function(n,t){n.pos=t,n.shuffle(function(n){n===o.length-1&&e()})})})},card:function(i){var u=i.$el;i.shuffle=function(n){var t,e=i.pos,o=e/4,r=2*e;i.animateTo({delay:r,duration:200,x:(t=40*Math.random()+20,(Math.round(Math.random())?-1:1)*t*m/16),y:-o,rot:0}),i.animateTo({delay:200+r,duration:200,x:-o,y:-o,rot:0,onStart:function(){u.style.zIndex=e},onComplete:function(){n(e)}})}}},h={deck:function(n){n.sort=n.queued(function(e,o){var r=n.cards;r.sort(function(n,t){return o?n.i-t.i:t.i-n.i}),r.forEach(function(n,t){n.sort(t,r.length,function(n){n===r.length-1&&e()},o)})})},card:function(u){var a=u.$el;u.sort=function(n,t,e,o){var r=n/4,i=10*n;u.animateTo({delay:i,duration:400,x:-r,y:-150,rot:0,onComplete:function(){a.style.zIndex=n}}),u.animateTo({delay:500+i,duration:400,x:-r,y:-r,rot:0,onComplete:function(){e(n)}})}}},x={deck:function(t){t.flip=t.queued(function(n,e){var o=t.cards.filter(function(n){return"front"===n.side}).length/t.cards.length;t.cards.forEach(function(n,t){n.setSide(e||(.5<o?"back":"front"))}),n()})}};function b(n){var o={};return(n=n||{}).on=function(n,t,e){o[n]||(o[n]=[]),o[n].push({cb:t,ctx:e})},n.one=function(n,t,e){o[n]||(o[n]=[]),o[n].push({cb:t,ctx:e,once:!0})},n.off=function(n,t){n?o[n]=t?o[n].filter(function(n){return n.cb!==t}):[]:o={}},n.trigger=function(n){var t=this,e=Array.prototype.slice(arguments,1);(o[n]||[]).filter(function(n){return n.cb.apply(t,e),!n.once})},n}function g(n){var r=Array.prototype,e=[];function i(n){n&&(e.push(n),1===e.length)&&!function t(){e[0](function(n){if(n)throw n;(e=e.slice(1)).length&&t()})}()}n.queue=i,n.queued=function(o){return function(){var t=this,e=arguments;i(function(n){o.apply(t,r.concat.apply(n,e))})}}}var O=52;function w(n,t=0,e=0,o=!1){var r,i,m=S("transform"),u=n%13+1,a=n/13|0,c=(52-n)/4,v=q("div"),d=q("div"),s=q("div"),f=!1,l=!1,y=!1,p=!1,h=30,x=null,b={i:n,rank:u,suit:a,pos:n,$el:v,mount:function(n){n.appendChild(v),b.$root=n},unmount:function(){b.$root&&b.$root.removeChild(v),b.$root=null},setSide:function(n){"front"===n?("back"===b.side&&v.removeChild(s),b.side="front",v.appendChild(d),b.setRankSuit(b.rank,b.suit)):("front"===b.side&&v.removeChild(d),b.side="back",v.appendChild(s),v.setAttribute("class","card"))}},g=z.modules;for(r in d.classList.add("face"),s.classList.add("back"),v.style[m]=M(-c+"px",-c+"px"),o&&(v.style.visibility="hidden"),b.x=t,b.y=e,b.z=c,b.rot=0,b.setSide("back"),E(v,"mousedown",w),E(v,"touchstart",w),g)(i=g[r]).card&&i.card(b);return b.animateTo=function(n){var e,o,r,i,u,a,{delay:n,duration:t,x:c=b.x,y:d=b.y,rot:s=b.rot,ease:f,onStart:l,onProgress:y,onComplete:p}=n;C(n,t).start(function(){e=b.x||0,o=b.y||0,r=b.rot||0,v.style.visibility="visible",l&&l()}).progress(function(n){var t=I[f||"cubicInOut"](n);i=c-e,u=d-o,a=s-r,y&&y(n,t),b.x=e+i*t,b.y=o+u*t,b.rot=r+a*t,v.style[m]=M(b.x+"px",b.y+"px")+(a?"rotate("+b.rot+"deg)":""),v.style.zIndex=O++}).end(function(){p&&p()})},b.moveUp=function(n=200,t=0){p||(p=!0,b.animateTo({x:b.x,y:b.y-h,duration:n,delay:t,ease:"quartOut"}))},b.moveDown=function(n=200,t=0){p&&(p=!1,b.animateTo({x:b.x,y:b.y+h,duration:n,delay:t,ease:"quartOut"}))},b.setRankSuit=function(n,t){t=0===(t=t)?"spades":1===t?"hearts":2===t?"clubs":3===t?"diamonds":"joker";v.setAttribute("class","card "+t+" rank"+n)},b.setRankSuit(u,a),b.getCardIndex=function(){return 13*a+(u-1)},b.enableDragging=function(){f||(f=!0,v.style.cursor="move")},b.enableFlipping=function(){l=l||!0},b.enableClicking=function(n){y||(x=n,y=!0,p&&k())},b.disableFlipping=function(){l=l&&!1},b.disableDragging=function(){f&&(f=!1,v.style.cursor="")},b.disableClicking=function(){y&&(y=!1,p&&k(),x=null)},b.isUp=function(){return p},b.setUpDistance=function(n){h=n},b;function w(n){var t={},e={},o=Date.now();function r(n){f&&("mousemove"===n.type?(e.x=n.clientX,e.y=n.clientY):(e.x=n.touches[0].clientX,e.y=n.touches[0].clientY),v.style[m]=M(Math.round(b.x+e.x-t.x)+"px",Math.round(b.y+e.y-t.y)+"px")+(b.rot?" rotate("+b.rot+"deg)":""))}function i(n){l&&Date.now()-o<200&&b.setSide("front"===b.side?"back":"front"),"mouseup"===n.type?(T(window,"mousemove",r),T(window,"mouseup",i)):(T(window,"touchmove",r),T(window,"touchend",i)),y&&Date.now()-o<200?k():f&&(b.x=b.x+e.x-t.x,b.y=b.y+e.y-t.y)}n.preventDefault(),"mousedown"===n.type?(t.x=e.x=n.clientX,t.y=e.y=n.clientY,E(window,"mousemove",r),E(window,"mouseup",i)):(t.x=e.x=n.touches[0].clientX,t.y=e.y=n.touches[0].clientY,E(window,"touchmove",r),E(window,"touchend",i)),f&&(v.style[m]=M(b.x+"px",b.y+"px")+(b.rot?" rotate("+b.rot+"deg)":""),v.style.zIndex=O++)}function k(){b.y+=p?h:-h,v.style[m]=M(b.x+"px",b.y+"px"),v.style.zIndex=p?--O:O++,x(p=!p)}}function E(n,t,e){n.addEventListener(t,e)}function T(n,t,e){n.removeEventListener(t,e)}function k(n){var e=n.cards;n.findOne=function(t){return e.find(({i:n})=>n===Number(t))},n.filter=function(t){return e.filter(({i:n})=>t.includes(n))}}function z(n){var t,e,o,r,i=new Array(n?54:52),u=q("div"),a=b({mount:function(n){(t=n).appendChild(u)},unmount:function(){t.removeChild(u)},cards:i,$el:u}),c=z.modules;for(e in g(a),k(a),c)(o=c[e]).deck&&o.deck(a);u.classList.add("deck");for(var d=i.length;d;d--)(r=i[d-1]=w(d-1)).setSide("back"),r.mount(u);return a}return z.animationFrames=C,z.ease=I,z.modules={bysuit:n,fan:t,intro:e,poker:o,shuffle:v,sort:h,flip:x},z.Card=w,z.prefix=S,z.translate=M,z}();